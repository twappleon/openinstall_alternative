# APK 下载功能测试说明

## ✅ 已完成的配置

1. ✅ APK 文件已复制到 `downloads/app.apk` (18MB)
2. ✅ 配置已更新为动态获取域名
3. ✅ 已重新部署到 Vercel

## 🧪 测试步骤

### 1. 测试 APK 直接下载

访问以下链接，应该能直接下载 APK：
```
https://openinstall-web.vercel.app/downloads/app.apk
```

### 2. 测试完整流程

1. **访问带参数的页面**：
   ```
   https://openinstall-web.vercel.app/?inviteCode=ABC123
   ```

2. **点击"立即下载"按钮**

3. **在 Android 设备上**：
   - 应该自动开始下载 APK 文件
   - 下载完成后可以安装

4. **在 iOS 设备上**：
   - 会跳转到 iOS App Store（需要配置 `iosAppStoreUrl`）

5. **在桌面浏览器上**：
   - 会显示"请在手机上打开此页面"

## 📱 在 Android 设备上测试

### 方法 1: 通过网页下载

1. 在 Android 手机上打开：
   ```
   https://openinstall-web.vercel.app/?inviteCode=TEST123
   ```

2. 点击"立即下载"按钮

3. 浏览器会开始下载 APK

4. 下载完成后，点击通知栏的下载完成提示

5. 如果提示"禁止安装未知来源应用"，需要：
   - 设置 → 安全 → 允许安装未知来源应用

### 方法 2: 直接下载链接

在 Android 浏览器中直接访问：
```
https://openinstall-web.vercel.app/downloads/app.apk
```

## 🔍 验证下载功能

### 检查 APK 文件是否可访问

在浏览器中访问：
```
https://openinstall-web.vercel.app/downloads/app.apk
```

**预期结果：**
- 浏览器开始下载 APK 文件
- 或者显示文件下载对话框

### 检查配置是否正确

1. 打开网页：https://openinstall-web.vercel.app/?inviteCode=TEST
2. 按 F12 打开开发者工具
3. 在 Console 中输入：
   ```javascript
   CONFIG.androidDownloadUrl
   ```
4. 应该显示：`https://openinstall-web.vercel.app/downloads/app.apk`

## ⚠️ 注意事项

1. **文件大小**：APK 文件约 18MB，下载可能需要一些时间

2. **HTTPS 要求**：Android 8.0+ 要求通过 HTTPS 下载 APK

3. **未知来源**：首次安装可能需要允许"未知来源"应用

4. **iOS 配置**：如果需要支持 iOS，需要配置：
   - `iosAppStoreUrl`: App Store 链接
   - Universal Link（可选）

## 🔄 更新 APK 文件

如果需要更新 APK：

1. 重新构建 Flutter APK：
   ```bash
   cd openinstall-flutter/example
   flutter build apk
   ```

2. 复制新的 APK：
   ```bash
   cp build/app/outputs/flutter-apk/app-release.apk ../openinstall-web/downloads/app.apk
   ```

3. 重新部署：
   ```bash
   cd ../openinstall-web
   npx vercel --prod
   ```

## 📊 完整流程

```
用户访问网页
    ↓
显示邀请码等信息
    ↓
上传设备指纹到后端
    ↓
用户点击"立即下载"
    ↓
尝试拉起已安装的 App（如果已安装）
    ↓
如果未安装，跳转到下载链接
    ↓
下载 APK 文件
    ↓
安装 App
    ↓
App 启动后获取追踪参数
```

## 🐛 故障排查

### 问题：点击下载没有反应

**检查：**
1. 浏览器控制台是否有错误
2. APK 文件是否可访问
3. 网络连接是否正常

### 问题：下载失败

**检查：**
1. APK 文件是否存在：https://openinstall-web.vercel.app/downloads/app.apk
2. 文件大小是否正确（约 18MB）
3. Vercel 部署是否成功

### 问题：无法安装 APK

**检查：**
1. Android 版本是否支持
2. 是否允许"未知来源"应用
3. APK 文件是否损坏（重新下载）

