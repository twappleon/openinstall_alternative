# APK 更新说明

## ✅ 已完成的更新

1. ✅ 重新构建了修复闪退问题的新 APK
2. ✅ 已更新到 Vercel 部署
3. ✅ 下载链接已更新

## 📱 测试步骤

### 1. 访问网页

打开以下链接：
```
https://openinstall-web.vercel.app/?inviteCode=ABC123
```

### 2. 点击"立即下载"按钮

在 Android 设备上：
- 点击"立即下载"按钮
- 应该会自动开始下载新的 APK 文件（18MB）

### 3. 安装新版本

1. 下载完成后，点击通知栏的下载完成提示
2. 如果提示"禁止安装未知来源应用"，需要：
   - 设置 → 安全 → 允许安装未知来源应用
3. 安装新版本 APK

### 4. 测试应用

1. 启动应用
2. 应该不会再闪退
3. 应用会尝试获取安装参数
4. 如果之前从网页上传过设备指纹，应该能匹配到参数

## 🔍 新版本改进

### 修复的问题：
- ✅ 添加全局错误处理，防止未捕获异常导致崩溃
- ✅ 改进初始化流程，避免在 widget 未完全构建时调用 setState
- ✅ 添加网络请求超时处理（10秒）
- ✅ 增强错误处理，设备信息获取失败时使用默认值
- ✅ 添加 mounted 检查，防止在 widget dispose 后操作

### 功能：
- ✅ 自动收集设备指纹
- ✅ 上传设备指纹到后端
- ✅ 匹配并获取追踪参数（邀请码、渠道ID等）
- ✅ 显示追踪参数信息

## 📊 完整流程测试

### 步骤 1: 在网页上传设备指纹

1. 访问：https://openinstall-web.vercel.app/?inviteCode=TEST123
2. 页面会自动上传设备指纹到后端
3. 查看浏览器控制台，确认上传成功

### 步骤 2: 下载并安装 App

1. 点击"立即下载"按钮
2. 下载并安装 APK
3. 启动应用

### 步骤 3: App 获取参数

1. App 启动后会自动收集设备指纹
2. 查询后端，匹配之前上传的设备指纹
3. 如果匹配成功，会显示追踪参数（邀请码：TEST123）

## 🐛 如果仍有问题

### 查看应用日志

```bash
# 连接设备后
adb logcat | grep -E "flutter|openinstall"
```

### 查看网页日志

1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 查看是否有错误信息

### 检查后端

确认后端服务正常运行：
```
https://openinstall-backend.zeabur.app/api/tracking/get
```

## 📝 注意事项

1. **首次安装**：可能需要允许"未知来源"应用
2. **网络权限**：确保设备有网络连接
3. **设备指纹匹配**：需要在同一设备上测试网页和 App
4. **参数匹配**：如果未匹配到参数，可能是：
   - 设备指纹不完全一致
   - 数据已过期
   - 未从分享链接访问

## 🔗 相关链接

- 网页：https://openinstall-web.vercel.app/
- 后端 API：https://openinstall-backend.zeabur.app/api
- APK 下载：https://openinstall-web.vercel.app/downloads/app.apk

