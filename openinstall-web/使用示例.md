# OpenInstall Web 使用示例

## 🚀 快速开始

你的网站已部署在：**https://openinstall-web.vercel.app/**

## 📝 使用示例

### 示例 1: 带邀请码的分享链接

```
https://openinstall-web.vercel.app/?inviteCode=INVITE001
```

**使用场景：** 用户 A 邀请用户 B，生成带邀请码的链接分享给用户 B

### 示例 2: 渠道推广链接

```
https://openinstall-web.vercel.app/?channelId=wechat&inviteCode=WX001
```

**使用场景：** 在微信渠道推广，记录渠道来源

### 示例 3: 完整参数链接

```
https://openinstall-web.vercel.app/?inviteCode=ABC123&channelId=channel1&userId=user123&custom=extra_data
```

**使用场景：** 需要传递多个追踪参数

## 🔄 完整流程演示

### 步骤 1: 生成分享链接

假设用户 ID 为 `user123`，邀请码为 `INVITE001`，生成链接：

```
https://openinstall-web.vercel.app/?inviteCode=INVITE001&userId=user123
```

### 步骤 2: 用户点击链接

1. 用户点击链接，打开网页
2. 网页自动收集设备指纹（屏幕尺寸、时区、Canvas指纹等）
3. 将设备指纹 + URL参数上传到后端服务器
4. 页面显示邀请码等信息

### 步骤 3: 用户下载/打开 App

1. 用户点击"立即下载"按钮
2. 如果已安装 App，尝试拉起 App
3. 如果未安装，跳转到应用商店

### 步骤 4: App 获取参数

1. App 启动后，调用 SDK 获取安装参数
2. SDK 收集设备指纹并查询后端
3. 后端匹配设备指纹，返回之前保存的追踪参数
4. App 获取到邀请码、渠道ID等参数

## 🧪 测试步骤

### 1. 测试网页参数显示

访问：
```
https://openinstall-web.vercel.app/?inviteCode=TEST123
```

**预期结果：**
- 邀请码显示：TEST123
- 渠道显示：-
- 用户ID显示：-

### 2. 测试设备指纹上传

1. 打开浏览器开发者工具（按 F12）
2. 切换到 Console 标签
3. 访问带参数的链接
4. 查看控制台输出

**成功时应该看到：**
```
数据上传成功: {success: true, ...}
```

**失败时可能看到：**
```
数据上传失败: Error: ...
```

### 3. 测试 App 匹配

1. 在网页上上传设备指纹（带参数）
2. 在同一设备上打开 App
3. App 调用 `getInstallParams()` 方法
4. 应该能获取到之前上传的参数

## 📱 在 App 中集成

### Flutter 示例代码

```dart
import 'package:openinstall_flutter/openinstall_flutter.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatefulWidget {
  @override
  _MyAppState createState() => _MyAppState();
}

class _MyAppState extends State<MyApp> {
  @override
  void initState() {
    super.initState();
    _initOpenInstall();
  }

  void _initOpenInstall() {
    // 初始化 SDK（使用默认后端地址）
    OpenInstall().init();
    
    // 获取安装参数
    _getInstallParams();
  }

  Future<void> _getInstallParams() async {
    final params = await OpenInstall().getInstallParams();
    
    if (params != null) {
      print('获取到邀请码: ${params.inviteCode}');
      print('获取到渠道ID: ${params.channelId}');
      print('获取到用户ID: ${params.userId}');
      
      // 处理业务逻辑
      if (params.inviteCode != null) {
        // 建立邀请关系
        await _handleInviteCode(params.inviteCode!);
      }
    } else {
      print('未匹配到安装参数');
    }
  }

  Future<void> _handleInviteCode(String code) async {
    // 调用你的业务 API
    // await api.establishInviteRelation(code: code);
  }
}
```

## ⚙️ 配置检查清单

在正式使用前，请确保已配置：

- [x] API 地址：`https://openinstall-backend.zeabur.app/api` ✅
- [ ] App URL Scheme（如：`myapp://`）
- [ ] Universal Link 域名（iOS）
- [ ] iOS App Store 链接
- [ ] Android 下载链接

## 🔍 故障排查

### 问题：页面一直显示"加载中..."

**可能原因：**
1. 后端 API 连接失败
2. CORS 跨域问题
3. 网络连接问题

**解决方法：**
1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签的错误信息
3. 查看 Network 标签的请求状态
4. 检查后端服务是否正常运行

### 问题：设备指纹上传失败

**检查：**
1. 后端 API 地址是否正确
2. 后端服务是否正常运行
3. 网络是否能访问后端地址

### 问题：App 无法获取参数

**检查：**
1. 是否在同一设备上测试
2. 设备指纹是否匹配
3. 后端数据是否保存成功
4. App 中的 API 地址是否正确

## 📊 数据流程

```
┌─────────────┐
│  用户点击    │
│  分享链接    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  打开网页    │
│  收集指纹    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  上传到后端  │
│  (设备指纹+  │
│   URL参数)   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  用户下载    │
│  并打开App   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  App收集指纹 │
│  查询后端    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  后端匹配    │
│  返回参数    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  App获取到   │
│  追踪参数    │
└─────────────┘
```

## 💡 最佳实践

1. **生成分享链接时**：使用短链接服务（如 bit.ly）让链接更美观
2. **参数传递**：只传递必要的参数，避免 URL 过长
3. **错误处理**：在 App 中做好参数为空的处理
4. **数据验证**：在后端验证参数的有效性
5. **安全性**：对敏感参数进行加密或签名

