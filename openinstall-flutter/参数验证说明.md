# 参数验证说明

## ✅ 已添加的功能

App 现在可以：
1. ✅ 自动获取落地页参数
2. ✅ 在 UI 上显示所有参数
3. ✅ 显示获取状态（加载中、成功、失败）
4. ✅ 支持重新获取参数
5. ✅ 输出详细日志

## 📱 验证步骤

### 步骤 1: 在网页上传设备指纹

1. **访问网页**（带参数）：
   ```
   https://openinstall-web.vercel.app/?inviteCode=TEST123&channelId=wechat&userId=user001
   ```

2. **等待自动上传**：
   - 页面会自动收集设备指纹
   - 上传到后端服务器
   - 查看浏览器控制台确认上传成功

### 步骤 2: 安装并打开 App

1. **下载并安装 APK**
2. **打开 App**
3. **观察界面**：
   - 会显示"正在初始化 SDK..."
   - 然后显示"正在获取安装参数..."
   - 最后显示结果

### 步骤 3: 验证参数

#### ✅ 如果成功获取到参数：

界面会显示：
- ✅ **成功提示**：绿色卡片显示"成功获取到安装参数"
- **参数详情**：
  - 邀请码：TEST123
  - 渠道ID：wechat
  - 用户ID：user001
  - 自定义参数：-
- **重新获取按钮**：可以点击刷新

#### ❌ 如果未获取到参数：

界面会显示：
- ❌ **错误提示**：灰色图标和"未匹配到安装参数"
- **可能原因**：
  1. 未从分享链接访问网页
  2. 数据已过期
  3. 设备指纹不匹配
  4. 网页未上传设备指纹

## 🔍 查看日志

### 方法 1: 使用 Flutter 日志

```bash
cd openinstall-flutter/example
flutter logs
```

### 方法 2: 使用 adb logcat

```bash
export PATH=$PATH:$HOME/Library/Android/sdk/platform-tools
adb logcat | grep -E "flutter|openinstall"
```

### 关键日志信息

成功时会看到：
```
✅ 获取到安装参数: TrackingParams(...)
邀请码: TEST123
渠道ID: wechat
用户ID: user001
```

失败时会看到：
```
❌ 未匹配到安装参数
```

## 📊 完整测试流程

### 1. 准备测试数据

在网页 URL 中添加参数：
```
https://openinstall-web.vercel.app/?inviteCode=ABC123&channelId=test&userId=testuser
```

### 2. 上传设备指纹

- 打开网页（会自动上传）
- 查看浏览器控制台确认成功

### 3. 安装 App

- 下载并安装 APK
- 在同一设备上打开 App

### 4. 验证结果

- App 启动后会自动获取参数
- 界面显示获取到的参数
- 日志输出详细信息

## 🎯 验证要点

### ✅ 成功标志

1. **UI 显示**：
   - 绿色成功提示
   - 参数卡片显示具体值
   - 有 ✅ 标记

2. **日志输出**：
   - "✅ 获取到安装参数"
   - 显示具体参数值

### ❌ 失败标志

1. **UI 显示**：
   - 灰色信息图标
   - "未匹配到安装参数"
   - 显示可能原因

2. **日志输出**：
   - "❌ 未匹配到安装参数"

## 🔄 重新获取

如果第一次未获取到，可以：

1. **点击"重新获取"按钮**
2. **或者重新启动 App**
3. **检查网页是否已上传设备指纹**

## 📝 注意事项

1. **设备一致性**：
   - 网页和 App 必须在同一设备上测试
   - 设备指纹需要匹配

2. **时间限制**：
   - 数据可能有过期时间
   - 建议在网页上传后立即测试

3. **网络连接**：
   - 确保设备有网络连接
   - 确保后端 API 可访问

4. **参数格式**：
   - URL 参数格式：`?key1=value1&key2=value2`
   - 参数会自动传递到后端

## 🐛 故障排查

### 问题：一直显示"正在获取参数..."

**可能原因**：
- 网络连接问题
- 后端 API 无响应
- 超时（10秒）

**解决**：
- 检查网络连接
- 检查后端服务
- 查看日志错误信息

### 问题：显示"未匹配到安装参数"

**可能原因**：
- 网页未上传设备指纹
- 设备指纹不匹配
- 数据已过期

**解决**：
1. 重新访问网页（带参数）
2. 确认设备指纹已上传
3. 立即在 App 中获取参数

### 问题：参数显示为 "-"

**说明**：
- 这是正常的
- 表示该参数未在 URL 中提供
- 只有提供的参数才会显示值

